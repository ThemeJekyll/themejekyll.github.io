$(document).ready(function(){var a;var b=new LazyLoad();imgLoaded=false;var c=$(document).scrollTop();$(".button-collapse").sideNav();$(".modal").modal();$("select").material_select();$("#slideout-close").on("click",function(){$(".button-collapse").sideNav("hide")});$.getJSON("/themes.json",function(g){var e=g;$("#loader").hide();var f=Handlebars.compile($("#themeTemplate").html());var l=Handlebars.compile($("#themePageTemplate").html());var u=Handlebars.compile($("#featureTemplate").html());var o=Handlebars.compile($("#categoryTemplate").html());var q=Handlebars.compile($("#layoutTemplate").html());function w(z){var y=_.sortBy(z,function(E){return E.date}).reverse();var D=[];var C=[];var B=[];var A=_.pluck($(".chips-autocomplete").material_chip("data"),"tag");$("#features :checkbox:checked").each(function(E,F){D.push($(F).attr("data-name"))});$("#categories :checkbox:checked").each(function(E,F){C.push($(F).attr("data-name"))});$("#layouts :checkbox:checked").each(function(E,F){B.push($(F).attr("data-name"))});y=_.filter(y,function(E){return _.every(D,function(F){return _.contains(E.features,F)})});y=_.filter(y,function(E){return _.every(C,function(F){return _.contains(E.categories,F)})});y=_.filter(y,function(E){return _.every(B,function(F){return _.contains(E.layouts,F)})});y=_.filter(y,function(E){return _.every(A,function(F){return _.contains(E.tags,F)})});y=_.filter(y,function(E){return s.include(String(E.title).toLowerCase(),$("#searchBox").val().toLowerCase())});return y}function d(z,A){var y=z;switch(A){case"featured":y=_.sortBy(y.reverse(),"featured").reverse();break;case"name":y=_.sortBy(y,"title");break;case"newest":y=_.sortBy(y,"date").reverse();break;case"oldest":y=_.sortBy(y,"date");break}return y}function r(y){return f(y)}function j(z,A,y){var B=$("<div>");z.slice(A,y).forEach(function(C){$(B).append(r(C))});$("#themeView").append($(B).html());if(z.length>y){$(".load-more").show()}else{$(".load-more").hide()}if(imgLoaded){b.update()}}function t(y){$.ajax({url:"https://themejekyll-chromatical.rhcloud.com/update",data:JSON.stringify({url:y}),method:"POST",contentType:"application/json",success:function(A){var z=_.findIndex(e,{url:y});if(z!==-1){e[z]=A;if($("#"+y+"-theme").length>0){$("#"+y+"-theme").html($(r(e[z])).html());b.update()}}}})}function v(){$(document).scrollTop(0);$("#themeView").empty()}function i(){$("#searchBox").val("");$(".chips-autocomplete .chip .close").click();$("#filters").find(":checkbox:checked").prop("checked",false);k()}function x(z,y){switch(z){case"feature":$("#features").append(u(y));break;case"category":$("#categories").append(o(y));break;case"layout":$("#layouts").append(q(y));break}}function h(y){$("#features :checkbox").each(function(z,A){if(!_.contains(y.features,$(A).attr("data-name"))){$(A).attr("disabled",true)}else{$(A).removeAttr("disabled")}});$("#categories :checkbox").each(function(z,A){if(!_.contains(y.categories,$(A).attr("data-name"))){$(A).attr("disabled",true)}else{$(A).removeAttr("disabled")}});$("#layouts :checkbox").each(function(z,A){if(!_.contains(y.layouts,$(A).attr("data-name"))){$(A).attr("disabled",true)}else{$(A).removeAttr("disabled")}})}var k=function(){var y=d(w(e),$("#sortSelect").val());v();if(y.length>0){$("#noThemesFound").hide();j(y,0,30)}else{$("#noThemesFound").show()}h({features:_.uniq(_.flatten(_.pluck(y,"features"))),categories:_.uniq(_.flatten(_.pluck(y,"categories"))),layouts:_.uniq(_.flatten(_.pluck(y,"layouts")))})};function m(z){c=$(document).scrollTop();var y=_.where(e,{url:z})[0];$("body").removeClass("home").addClass("show-theme");$("#theme-wrapper").empty().html(l(y));$("title").text(y.title+" | ThemeJekyll - Jekyll Themes Gallery");$("#theme-wrapper").show();$(document).scrollTop(0);a=new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:true,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",loop:true})}function n(){$("body").removeClass("show-theme").addClass("home");$("#theme-wrapper").fadeOut(function(){a.destroy();$("#theme-wrapper").empty();$("title").text("ThemeJekyll - Jekyll Themes Gallery")});$(document).scrollTop(c)}$("#filters-clear").on("click",function(){i()});$(document).on("change",".filter",function(){k()});$("#searchBox").on("input",function(){k()});$("#sortSelect").on("change",function(){k()});$("#showMore").on("click",function(){var y=$(".theme").length;j(d(w(e)),y,y+30)});$(document).on("click","#back-to-themes",function(y){y.preventDefault();history.back()});$(document).on("click",".theme-url",function(y){y.preventDefault();history.pushState($(this).attr("href"),"",$(this).attr("href"));m($(this).attr("data-theme"))});$(window).on("popstate",function(y){if(y.target.location.href===window.location.origin+"/themes/"){n()}else{if(_.last(y.target.window.location.href)!=="#"&&y.target.window.location.hash[0]!=="#"){m(_.last(y.target.location.href.split("/"),2)[1])}}});_.uniq(_.flatten(_.pluck(e,"features"))).sort().forEach(function(y){x("feature",{idslug:s.slugify(y),name:y})});_.uniq(_.flatten(_.pluck(e,"categories"))).sort().forEach(function(y){x("category",{idslug:s.slugify(y),name:y})});_.uniq(_.flatten(_.pluck(e,"layouts"))).sort().forEach(function(y){x("layout",{idslug:s.slugify(y),name:y})});var p=_.uniq(_.flatten(_.pluck(e,"tags")));$(".chips-autocomplete").material_chip({autocompleteOptions:{data:_.object(p,[]),limit:Infinity,minLength:1},secondaryPlaceholder:"+tag"});$(".chips-autocomplete").on("chip.add",function(z,y){if(!_.contains(p,y.tag)){$(".chips-autocomplete .chip .close").last().click()}else{k()}});$(".chips-autocomplete").on("chip.delete",function(z,y){k()});k();$("#themeView").imagesLoaded(function(){imgLoaded=true;b.update()})}).fail(function(){$("#loader").fadeOut(function(){$("#loadFailed").show()})})});